@model IList<TbFaCotizacion>
@inject IStringLocalizer<SharedResources> Lb
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
@{
    var monedas = ViewData["monedas"] as IList<TbSeMoneda>;
    var usuarios = ViewData["usuarios"] as IList<TbSeUsuario>;
}
<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12 table-responsive">
        <table class="table table-bordered" id="tblCotizaciones">
            <thead>
                <tr>
                    <th>@Lb["Id"]</th>
                    <th>@Lb["FechaDeCotizacion"]</th>
                    <th>@Lb["Cliente"]</th>
                    <th>@Lb["Estado"]</th>
                    <th> @Lb["Moneda"]</th>
                    <th>@Lb["Vendedor"]</th>
                    <th>@Lb["IdUsuarioCreador"]</th>
                    <th>@Lb["fechaCreacion"]</th>
                    <th>@Lb["FechaDeVencimiento"]</th>
                    <th>@Lb["Total"]</th>
                    <th>@Lb["FechaModificacion"]</th>
                    <th>@Lb["Acción"]</th>
                </tr>
            </thead>
            <tbody>
              @foreach (var item in Model)
                {                    
                <tr>
                    <td>@item.IdCotizacion</td>
                    <td>@item.FechaCotizacion</td>
                    @{
                        var cliente = item.IdClienteNavigation.Persona ? item.IdClienteNavigation.Nombre + " " + item.IdClienteNavigation.Apellidos : item.IdClienteNavigation.NombreComercial;
                    }
                    <td>@cliente</td>
                    <td>@item.Estado</td>
                    <td>@monedas.FirstOrDefault(m => m.Codigo == item.IdMoneda).Nombre</td>
                    @{
                        var total = item.IdMoneda == 1 ? item.TotalBase : item.IdMoneda == 2 ? item.TotalDolar : item.TotalEuro;
                    }
                    <td>@usuarios.FirstOrDefault(u => u.Id == item.IdVendedor).Nombre</td>
                    <td>@item.IdUsuarioCreador</td>
                    <td>@item.FechaCreacion</td>
                    <td>@item.FechaVencimiento</td>
                    <td style="text-align:right" class="colon">

                        @{ CultureInfo us = CultureInfo.CreateSpecificCulture("en-US"); }
                        <p>@monedas.FirstOrDefault(m => m.Codigo == item.IdMoneda).Simbolo  @total.ToString("0,0.00", us)</p>

                    </td>
                    <td>@item.FechaModificacion</td>
                    <td><a href="@Url.Action("EditarCotizacion", new { id=item.IdCotizacion })" class="btn btn-link" style="margin: 0; padding:0;"><i style="font-size:2rem" class="fas fa-edit"></i></a></td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<script>
    var hasta;
    var desde;
    $(document).ready(function () {
         hasta = new Date().toLocaleString();
        desde = new Date().toLocaleString();
        inicializarTabla();
    });
     function inicializarTabla() {
        $('#tblCotizaciones').DataTable().destroy();
        tblCotizacion = $('#tblCotizaciones').DataTable({
            "info": false,
            "order": [[10, "desc"]],
            language: {
                "decimal": "",
                "emptyTable": "@Lb["NoDatos"]",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "@Lb["Mostrar"] _MENU_ @Lb["Entradas"]",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "<i class='fas fa-search'></i>",
                "zeroRecords": "@Lb["sinResultados"]",
                "paginate": {
                    "first": "@Lb["Primero"]",
                    "last": "@Lb["Último"]",
                    "next": "@Lb["Sguiente"]",
                    "previous": "@Lb["Anterior"]"
                }
            },
           
        });
        $(".dataTables_searching").hide();
    }
       /////////////////////filtros//////////////////
    $('#Estados').on('change', function () {
        switch (this.value) {
            case "1":
                    tblCotizacion
                    .columns(3)
                    .search("@Lb["Borrador"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "2":
                tblCotizacion
                    .columns(3)
                    .search("@Lb["Enviada"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "3":
                 tblCotizacion
                    .columns(3)
                    .search("@Lb["Anulada"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "4":
                tblCotizacion
                    .columns(3)
                    .search("@Lb["Aceptada"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "5":
                tblCotizacion
                    .columns(3)
                    .search("@Lb["Rechazada"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "6":
                tblCotizacion
                    .columns(3)
                    .search("@Lb["Facturada"]")
                    .draw();
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                break;
            case "0":
                $('#filtroId').val("");
                $('#filtroCliente').val("");
                $('#filtroVendedor').val("");
                inicializarTabla();
        }
            });
    $("#filtroCliente").on("keyup", function () {
        tblCotizacion
            .columns(2)
            .search(this.value)
            .draw();
    });
    $("#filtroVendedor").on("keyup", function () {
        tblCotizacion
            .columns(5)
            .search(this.value)
            .draw();
    });
    $("#filtroId").on("keyup", function () {
        tblCotizacion
            .columns(0)
            .search(this.value)
            .draw();
    });
</script>