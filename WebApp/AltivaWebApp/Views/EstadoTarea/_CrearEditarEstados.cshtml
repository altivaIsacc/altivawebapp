@model AltivaWebApp.Domains.TbFdTareaEstado

@{
    ViewData["Title"] = "Costos por usuario";
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
<link href="~/lib/vendors/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
<script src="~/lib/vendors/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>


<div class="row">
    <div class="form-group col-md-12" hidden>
        <label>Id:</label>
        <input type="text" class="form-control" asp-for="Id" id="Id1" />
    </div>
    <div class="form-group col-md-12">
        <label>Título:</label>
        <input type="text" class="form-control" asp-for="Titulo" id="Titulo1" />
        <div id="AlertTitulo1"></div>
    </div>


    <div class="form-group col-md-4">
        <label>Color:</label>

        <input type="text" class=" form-control colorpicker" id="Color1" asp-for="Color" />
        <div id="AlertColor"> </div>
    </div>


    <div class="form-group col-sm-4 col-md-12">
        <label>Es por defecto: <span><i class="fas fa-question"></i></span></label>
        <div>
            <input type="checkbox" id="defecto" checked="@Model.EsDefecto" />
            <div id="AlertDefecto"></div>
        </div>
    </div>
    <div class="form-group col-sm-4 col-md-12">
        <label>Es inical: <span><i class="fas fa-question"></i></span></label>
        <div>
            <input type="checkbox" id="esInicial" checked="@Model.EsInicial" />
        </div>
    </div>
    <div class="form-group col-sm-4 col-md-12">
        <label>Es final: <span><i class="fas fa-question"></i></span></label>
        <div>
            <input type="checkbox" id="esFinal" checked="@Model.EsFinal" />
        </div>
    </div>
    <div class="form-group col-sm-4 col-md-12">
        <label>Activo: <span><i class="fas fa-question"></i></span></label>
        <div>
            <input type="checkbox" checked="@Model.Activo" id="activo" />
        </div>
    </div>
    @if (Model.Titulo == null)
    {
        <div class="form-group col-sm-4 col-md-12">
            <button type="button" id="GuardarEstado" class="btn btn-success">Guardar <i class="fas fa-save"></i></button>


            <button type="button" class="btn btn-default" id="btnCancelarEstados">Cancelar</button>
        </div>
    }
    else
    {
        <div class="form-group col-sm-4 col-md-12">
            <button type="button" id="EditarEstado" class="btn btn-success">Guardar <i class="fas fa-save"></i></button>


            <button type="button" class="btn btn-default" id="btnCancelarEstados">Cancelar</button>
        </div>
    }


</div>

<script>
    //cerrar modal
    $('#btnCancelarEstados').on('click', function () {
      

        $('#ModalEstados').modal('hide');

    });
    $(document).ready(function () {



        $('#esFinal').change(function () {
            if ($(this).prop('checked')) {
 
                $('#esInicial').prop('checked', false);
            }

        });
        $('#esInicial').change(function () {
            if ($(this).prop('checked')) {
                $('#esFinal').prop('checked', false);
            }

        });
        

    });
    //inicializacion del campo color
    $('.colorpicker').colorpicker();

    //guardar estado de la tarea
    $('#GuardarEstado').on('click', function () {
        if (ValidarDatos() == true) {
            var esFinal = "";
            var esInicio = "";
            var activo = "";
            var defecto = "";
            if ($('#defecto').prop('checked')) {
                defecto = true;
            } else {
                defecto = false;

            }
            if ($('#esFinal').prop('checked')) {
                esFinal = true;
            } else {
                esFinal = false;

            }
            if ($('#esInicial').prop('checked')) {
                esInicio = true;
            } else {
                esInicio = false;

            }
            if ($('#activo').prop('checked')) {
                activo = true;
            } else {
                activo = false;
                $('#Color').val('#858585');

            }
            var EstadoTarea = {
                Id: null,
                Titulo: $('#Titulo1').val(),
                Color: $('#Color1').val(),
                EsDefecto: defecto,
                EsInicial: esInicio,
                EsFinal: esFinal,
                Activo: activo

            };

            $.ajax({
                headers: {
                    "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                },
                type: "POST",


                url: '@Url.Action("CrearEstado", "EstadoTarea")',

                data: { domain: EstadoTarea },
                success: function (data) {
                    if (data.titulo == true) {
                        $('#AlertTitulo1').empty();
                        $('#AlertTitulo1').append('<span class="text-danger">El título no se puede repetir.</span>');
                        return false;
                    }
                    if (data.color == true) {
                        $('#AlertColor').empty();
                        $('#AlertColor').append('<span class="text-danger">Este color no puede ser seleccionado.</span>');
                        return false;
                    }
                    if (data.defecto == true) {
                        $('#AlertDefecto').empty();
                        $('#AlertDefecto').append('<span class="text-danger">Solo puede existir un tipo por defecto.</span>');
                        return false;
                    }
                  
                    $('#ModalEstados').modal('hide');
                    if ($("#activos").css("display") == "block") {

                        $("#inactivos").css("display", "none");
                        $("#activos").css("display", "block");
                        VerInactivos("inactivos");
                    } else {
                        $("#inactivos").css("display", "block");
                        $("#activos").css("display", "none");
                        verActivos(null);

                    }

                    return false;
                },

                error: function (err, scnd) {
                    console.log(err.statusText);
                }

            });

        }
    });
    //editar los datos de los estados de la tarea..

    $('#EditarEstado').on('click', function () {
        if (ValidarDatos() == true) {


            var esFinal = "";
            var esInicio = "";
            var activo = "";
            var defecto = "";
            if ($('#defecto').prop('checked')) {
                defecto = true;
            } else {
                defecto = false;

            }
            if ($('#esFinal').prop('checked')) {
                esFinal = true;
            } else {
                esFinal = false;

            }
            if ($('#esInicial').prop('checked')) {
                esInicio = true;
            } else {
                esInicio = false;

            }
            if ($('#activo').prop('checked')) {
                activo = true;
            } else {
                activo = false;
                $('#Color').val('#858585');

            }
            var EstadoTarea = {
                Id: $('#Id1').val(),
                Titulo: $('#Titulo1').val(),
                Color: $('#Color1').val(),
                EsDefecto: defecto,
                EsInicial: esInicio,
                EsFinal: esFinal,
                Activo: activo

            };

            $.ajax({
                headers: {
                    "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                },
                type: "POST",


                url: '@Url.Action("EditarEstado", "EstadoTarea")',

                data: { domain: EstadoTarea },
                success: function (data) {
                    if (data.titulo == true) {
                        $('#AlertTitulo').empty();
                        $('#AlertTitulo').append('<span class="text-danger">El título no se puede repetir.</span>');
                        return false;
                    }
                    if (data.color == true) {
                        $('#AlertColor').empty();
                        $('#AlertColor').append('<span class="text-danger">Este color no puede ser repetir.</span>');
                        return false;
                    }
                    if (data.defecto == true) {
                        $('#AlertDefecto').empty();
                        $('#AlertDefecto').append('<span class="text-danger">Solo puede existir un tipo por defecto.</span>');
                        return false;
                    }
                    $('#tablaEstados').empty();
                 
                    $('#ModalEstados').modal('hide');
                    if ($("#activos").css("display") == "block") {
                    
                        $("#inactivos").css("display", "none");
                        $("#activos").css("display", "block");
                        VerInactivos("inactivos");
                    } else { 
                        $("#inactivos").css("display", "block");
                        $("#activos").css("display", "none");
                        verActivos(null);
                   
                    }
                
                    return false;
                },

                error: function (err, scnd) {
                    console.log(err.statusText);
                }

            });
        }
    });
    function ValidarDatos() {
 
        if ($('#Titulo').val() == "") {
            $('#AlertTitulo1').empty();
            $('#AlertTitulo1').append('<span class="text-danger">El título es requerido.</span>');
            return false;
        }

        if ($('#activo').prop('checked')) {
            if ($('#Color').val() == '#858585') {
                $('#AlertColor').empty();
                $('#AlertColor').append('<span class="text-danger">Este color no puede ser seleccionado.</span>');
                return false;
            }
        }
        return true;
    }
    
</script>