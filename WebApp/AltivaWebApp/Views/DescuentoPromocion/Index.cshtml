
@inject IStringLocalizer<SharedResources> SharedLocalizer

@model AltivaWebApp.ViewModels.RebajaConfigViewModel

@inject IStringLocalizer<SharedResources> SharedLocalizer
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
        public string GetAntiXsrfRequestToken()
        {
            return Xsrf.GetAndStoreTokens(Context).RequestToken;
        }

    }


<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="form-group descuentoGeneralnGroup">
            <input type="checkbox" class="form-check-input" id="chkDescuentoGeneral" asp-for="ActivaMaxGeneral" />
            <label data-translate="chkDescuentoGeneral" class="form-check-label" for="chkDescuentoGeneral">Maximo descuento general en el sistema</label>

            <input id="txtPorcentajeDescuentoGeneral" type="number" min="0" max="100" asp-for="PorcMaxGeneral" class="form-control porcentaje" />
        </div>

        <div class="form-group descMaximoUsuario">
            <input type="checkbox" class="form-check-input" id="chkDescMaximoUsuario" asp-for="ActivaMaxUsuario"/>
            <label data-translate="chkDescMaximoUsuario" class="form-check-label" for="chkDescMaximoUsuario">Maximo de descuento permitido a ciertos usuarios  </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnDescMaximoUsuario"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group descMaximoUsuarioRango">
            <input type="checkbox" class="form-check-input" id="chkDescMaximoUsuarioRango" asp-for="ActivaMaxUsuarioRango" />
            <label data-translate="chkDescMaximoUsuarioRango" class="form-check-label" for="chkDescMaximoUsuarioRango">Maximo de descuento permitido a ciertos usuarios por rango de fechas </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnDescMaximoUsuarioRango"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group descMaximoUsuarioClave">
            <input type="checkbox" class="form-check-input" id="chkDescMaximoUsuarioClave" asp-for="ActivaMaxUsuarioClave" />
            <label data-translate="chkDescMaximoUsuarioClave" class="form-check-label" for="chkDescMaximoUsuarioClave">Maximo de descuento autorizado mediante clave especial y usuarios que autorizan  </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnDescMaximoUsuarioClave"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group ActPromoProd">
            <input type="checkbox" class="form-check-input" id="chkActPromoProd" asp-for="ActivaPromoProducto" />
            <label data-translate="chkActPromoProd" class="form-check-label" for="chkActPromoProd">Activar promociones de producto </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnActPromoProd"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group ActPromoUsuarioClave">
            <input type="checkbox" class="form-check-input" id="chkActPromoUsuarioClave" asp-for="ActivaPromoProductoUsuario" />
            <label data-translate="chkActPromoUsuarioClave" class="form-check-label" for="chkActPromoUsuarioClave">Activar promociones de los productos solo mediante clave especial y usuarios que autorizan  </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnActPromoUsuarioClave"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group ActDescProd">
            <input type="checkbox" class="form-check-input" id="chkActDescProd" asp-for="ActivaDescuentoPromoUsuario" />
            <label data-translate="chk ActDescProd" class="form-check-label" for="chk ActDescProd">Activar descuentos de productos </label>

            <p>
                <a class="btn btn-primary btn-xs" id="btnActDescProd"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <div class="form-group ActDescProdUsuarioClave">
            <input type="checkbox" class="form-check-input" id="chkActDescProdUsuarioClave" asp-for="ActivaDescuentoPromoUsuarioClave" />
            <label data-translate="chkActDescProdUsuarioClave" class="form-check-label acciones" for="chkActDescProdUsuarioClave">Activar descuentos de los productos solo mediante clave especial y usuarios que autorizan  </label>

            <p>
                <a class="btn btn-primary btn-xs config" id="btnActDescProdUsuarioClave"><span data-translate="Configurar">Configurar </span>&nbsp;<i class="fas fa-cog"></i></a>
            </p>
        </div>

        <hr />

        <div class="form-group">
            <button id="btnGuardar" class="btn btn-success" onclick="guardarConfiguracion()"><span data-translate="guardar">Guardar</span> <span><i class="fas fa-save"></i></span></button>
            <a class="btn btn-default" id="btnCancelar" data-translate="cancelar">@SharedLocalizer["Cancelar"]</a>
        </div>

    </div>
</div>


<div>
    <!-- Modal Maximo descuento permitido -->
    <div class="modal fade" id="modalMaximoDesc" tabindex="-1" role="dialog" aria-labelledby="maximoDescModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="maximoDescModallabel">@SharedLocalizer["Configuracion maximo descuento permitido"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal Maximo descuento permitido por Fecha-->
    <div class="modal fade" id="modalMaximoDescRango" tabindex="-1" role="dialog" aria-labelledby="maximoDescRangoModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="maximoDescRangoModallabel">@SharedLocalizer["Configuracion maximo descuento permitido por rango de Fecha"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal MAximo descuento permitido mediante clave autorizada -->
    <div class="modal fade" id="modalMaximoDescClave" tabindex="-1" role="dialog" aria-labelledby="maximoDescClaveModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="maximoDescClaveModallabel">@SharedLocalizer["Configuracion maximo descuento permitido mediante clave autorizada"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal Activar Promociones de productos -->
    <div class="modal fade" id="modalPromoProd" tabindex="-1" role="dialog" aria-labelledby="PromoProdModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="PromoProdModallabel">@SharedLocalizer["Configuracion promociones de producto"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal Activar Promociones de productos mediante clave-->
    <div class="modal fade" id="modalPromoProdClave" tabindex="-1" role="dialog" aria-labelledby="PromoProdClaveModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="PromoProdClaveModallabel">@SharedLocalizer["Configuracion de promociones de producto mediante clave"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal Activar descuentos de productos -->
    <div class="modal fade" id="modalDescProd" tabindex="-1" role="dialog" aria-labelledby="DescProdModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="DescProdModallabel">@SharedLocalizer["Configuracion de descuentos de productos"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <!-- Modal Activar descuentos de productos mediante clave -->
    <div class="modal fade" id="modalDescProdClave" tabindex="-1" role="dialog" aria-labelledby="DescProdClaveModallabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 data-translate="Configuracion" class="modal-title" id="DescProdClaveModallabel">@SharedLocalizer["Configuracion de descuentos de producto mediante clave"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="crearEditarPartial">

                </div>
            </div>
        </div>
    </div>
</div>

<script>
        $(document).ready(function () {

            //*********************Mostrar Modales**********************************

            $('#btnDescMaximoUsuario').click(function () {

                if ($('#chkDescMaximoUsuario').prop('checked')) {
                $('#modalMaximoDesc').modal('show');

                } else {
                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnDescMaximoUsuarioRango').click(function () {

                if ($('#chkDescMaximoUsuarioRango').prop('checked')) {
                $('#modalMaximoDescRango').modal('show');

                } else {
                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnDescMaximoUsuarioClave').click(function () {

                  if ($('#chkDescMaximoUsuarioClave').prop('checked')) {
                $('#modalMaximoDescClave').modal('show');

                } else {
                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnActPromoProd').click(function () {

                     if ($('#chkActPromoProd').prop('checked')) {
                         $('#modalPromoProd').modal('show');

                } else {
                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnActPromoUsuarioClave').click(function () {

                  if ($('#chkActPromoUsuarioClave').prop('checked')) {
                $('#modalPromoProdClave').modal('show');

                } else {

                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnActDescProd').click(function () {

                if ($('#chkActDescProd').prop('checked')) {
                $('#modalDescProd').modal('show');

                } else {

                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });

            $('#btnActDescProdUsuarioClave').click(function () {

               if ($('#chkActDescProdUsuarioClave').prop('checked')) {
                $('#modalDescProdClave').modal('show');

                } else {

                    cargarAlert("@SharedLocalizer["No ha seleccionado ningun elemento"]");
                }
        });


    }); //Fin de document ready

         function guardarConfiguracion() {

        var _porcentaje = $('#txtPorcentajeDescuentoGeneral').val();
        var _descGeneral = $('#chkDescuentoGeneral').is(':checked');
        var _descMaximoUsuario = $('#chkDescMaximoUsuario').is(':checked');
        var _descMaximoUsuarioRango = $('#chkDescMaximoUsuarioRango').is(':checked');
        var _descMaximoUsuarioClave = $('#chkDescMaximoUsuarioClave').is(':checked');
        var _actPromoProd = $('#chkActPromoProd').is(':checked');
        var _actPromoUsuarioClave = $('#chkActPromoUsuarioClave').is(':checked');
        var _actDescProd = $('#chkActDescProd').is(':checked');
        var _actDescProdUsuarioClave = $('#chkActDescProdUsuarioClave').is(':checked');
             var id = @Model.IdRebajaConfig;

             var model = {
                        IdRebajaConfig: id,
                        PorcMaxGeneral: _porcentaje,
                        ActivaMaxGeneral: _descGeneral,
                        ActivaMaxUsuario: _descMaximoUsuario,
                        ActivaMaxUsuarioRango: _descMaximoUsuarioRango,
                        ActivaMaxUsuarioClave: _descMaximoUsuarioClave,
                        ActivaPromoProducto: _actPromoProd,
                        ActivaPromoProductoUsuario: _actPromoUsuarioClave,
                        ActivaDescuentoPromoUsuario: _actDescProd,
                        ActivaDescuentoPromoUsuarioClave: _actDescProdUsuarioClave
             }

            $.ajax({
            type: "post",
                headers: {
                "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                },
                url: '@Url.Action("ActualizarConfig")',
                data: model,
                success: function (data) {
                    cargarAlert("@SharedLocalizer["OperacionExitosa"]");
            },
                error: function (err, scnd) {
                    @*cargarAlert("@SharedLocalizer("errorGeneral")");*@
                    console.log(err.statusText);
            }
        });
    }
</script>
