@model AltivaWebApp.ViewModels.AjusteViewModel
@inject IStringLocalizer<SharedResources> SharedLocalizer
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}

@{

    var estado = "disabled";
    ViewData["Title"] = "CrearEditarAjuste";
}


@if (Model.Id != 0)
{
    <h3>@SharedLocalizer["editarAjuste"]</h3>
}
else
{
    <h3>@SharedLocalizer["nuevoAjuste"]</h3>
}

<hr />
<div class="row well">

    <div class="col-md-12 text-left">
        @if (Model.Id != 0 && !Model.Anulada)
        {
            <button class="btn btn-danger btn-sm" onclick="anularAjuste()">@SharedLocalizer["Anular"]</button>
            estado = "";
        }
        else if(Model.Id != 0)
        {
            <h5 class="text-danger">@SharedLocalizer["AjusteAnulado"]</h5>
        }
    </div>

    <form class="frmAjuste">
        @Html.HiddenFor(x => x.Id)
        @Html.HiddenFor(x => x.Anulada)
        @Html.HiddenFor(x => x.IdUsuario)
        @Html.HiddenFor(x => x.FechaCreacion)

        <div class="form-group col-md-3">

            <fieldset>
                <div class="form-group">
                    <label for="fecha">@SharedLocalizer["Fecha"]:</label>
                    <div class='input-group date' id='fechaPicker'>
                        <input type='text' class="form-control" id="fecha" />
                        <span class="input-group-addon">
                            <span class="fas fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </fieldset>
        </div>

        <div class="form-group col-md-2 col-xs-12">
            <label asp-for="IdBodega" class="control-label">@SharedLocalizer["Bodega"]:</label>
            <select class="form-control" asp-for="IdBodega" id="bodegas">
                @*<option value="0">@SharedLocalizer["Seleccione"]</option>*@
            </select>
        </div>
        <div class="form-group col-md-5 col-xs-12">
            <label asp-for="Descripcion" class="control-label">@SharedLocalizer["Descripción"]:</label>
            <textarea asp-for="Descripcion" rows="4" maxlength="250" class="form-control"></textarea>
            <span hidden class="text-danger" id="descripcionAjusteValid">@SharedLocalizer["descripcionValid"]</span>
        </div>

        <div class="form-group col-md-2 col-xs-12">
            <label class="control-label">@SharedLocalizer["Usuario"]:</label>
            <input type="text" readonly class="form-control" value="@Context.Session.GetString("nombreUsuario")" />
        </div>

    </form>

    <br />

    <div class="col-md-12">
        <h4>@SharedLocalizer["LineasAjuste"]</h4>
    </div>


    <div class="col-md-12 table-responsive" >
        <table class="table" id="tblAjusteInventario" >
            <thead>
                <tr>
                    <th>
                        <span>@SharedLocalizer["Item"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["Descripción"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["Movimiento"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["Cantidad"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["CostoPromedio"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["Total"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["cuentaContable"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["CuentaCosto"]</span>
                    </th>
                    <th>
                        <span>@SharedLocalizer["accion"]</span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="lineaForm">
                    <td style="width:18rem;"><select class="form-control" id="items"></select></td>
                    <td><input class="form-control" type="text" id="descripcionLinea" maxlength="100" /></td>
                    <td>
                        <select class="form-control" id="movimiento">
                            <option value="true">@SharedLocalizer["Entrada"]</option>
                            <option value="false">@SharedLocalizer["Salida"]</option>
                        </select>
                    </td>
                    <td style="width:11rem;"><input id="cantidad" class="form-control" type="number" min="1" value="1" /></td>
                    <td style="width:15rem;"><input id="costoPromedio" class="form-control moneda" type="number"  /></td>
                    <td style="width:15rem;"><input type="text" class="form-control moneda" readonly id="total" /></td>
                    <td>
                        <select class="form-control" id="cuentaContable">
                            @{foreach (var item in ViewData["CuentaContable"] as IList<TbCoCuentaContable>)
                                {
                                    <option value="@item.Id">@item.CuentaContable</option>
                                }
                            }
                        </select>
                    </td>
                    <td>
                        <select class="form-control" id="cuentaCosto">
                            @{foreach (var item in ViewData["CuentaCosto"] as IList<TbCoCentrosDeGastos>)
                                {
                                    <option value="@item.Id">@item.Codigo</option>
                                }
                            }
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-link btnAccion" onclick="guardarLinea()"><i class="fas fa-save"></i></button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>


    <form class="col-md-3 col-md-offset-9 frmAjuste2">

        <div class="form-group col-xs-12">
            <label asp-for="TotalEntrada" class="control-label">@SharedLocalizer["Entrada"]</label>
            <input readonly id="entradas" class="form-control currency" type="text" />
            <span asp-validation-for="TotalEntrada" class="text-danger"></span>
        </div>
        <div class="form-group col-xs-12">
            <label asp-for="TotalSalida" class="control-label">@SharedLocalizer["Salida"]</label>
            <input readonly id="salidas" class="form-control currency" type="text" />
            <span asp-validation-for="TotalSalida" class="text-danger"></span>
        </div>
        <div class="form-group col-xs-12">
            <label asp-for="SaldoAjuste" class="control-label">@SharedLocalizer["Saldo"]</label>
            <input readonly id="saldo" class="form-control currency" type="text" />
            <span asp-validation-for="SaldoAjuste" class="text-danger"></span>
        </div>

    </form>

    <div class="form-group col-md-2">
        <button class="btn btn-success btnAccion" onclick="guardarCambios()">@SharedLocalizer["Guardar"] <i class="fas fa-save"></i></button>
        <a onclick="cancelar()" class="btn btn-default">@SharedLocalizer["Cancelar"]</a>
    </div>

</div>

<div class="row">
    <div class="col-md-10">
        <div id="comentarios">

        </div>
    </div>
</div>

<script src="~/js/comentario.js"></script>


<script>

    var bodegas = [];
    var arrayItems = [];
    var arrayAjusteFromDB = [];
    var lineas = [];
    var lineasEliminadas = [];
    var lineasAgregadas = [];

    var frmAjuste = $('.frmAjuste');
    var frmAjuste2 = $('.frmAjuste2');
    var items = $('#items');
    var movimiento = $('#movimiento');
    var descripcionLinea = $('#descripcionLinea');
    var cantidad = $('#cantidad');
    var costoPromedio = $('#costoPromedio');
    var total = $('#total');
    var cuentaContable = $('#cuentaContable');
    var cuentaCosto = $('#cuentaCosto');
    var entradas = 0;
    var salidas = 0;
    var saldo = 0;
    var $entradas = $('#entradas');
    var $salidas = $('#salidas');
    var $saldo = $('#saldo');
    var fechaDocumento = $('#fecha');
    var arrayInventario = [];


    $(document).ready(function () {
        if (@Model.Id != 0) {
            GetComentarios("Ajuste", @Model.Id);
            $('#bodegas').attr('disabled', true);
        }
        

        getBodegasInventario();
        getAjusteInventario();
        inicializaTabla();

        validaAnulacion();

        $('#fechaPicker').datetimepicker({
            defaultDate: new Date(),
            locale: localStorage.getItem("idioma")
        });


        $(".moneda").inputmask({
            'alias': 'decimal',
            rightAlign: true,
        });
       

        $('#items').on('change.select2', function () {
            cargarCostoPromedio(arrayItems);
        });


    });


    function getAjusteInventario() {
        if(@Model.Id != 0)
        $.ajax({
              type: "get",
              headers: {
                  "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
              },
              dataType: "json",
            url: '@Url.Action("GetAjusteinventario", "AjusteInventario")',
            data: {id: @Model.Id},
            success: function (data) {

                arrayAjusteFromDB = JSON.parse(JSON.stringify(data.tbPrAjusteInventario));
                cargarLineas(data);
               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
          });
    }

    function guardarCambios() {

        console.log(lineas);

        if (validarCampos()) {
            if (lineas.length > 0) {
                if (@Model.Id != 0)
                    editarAjuste();
                else
                    guardarAjuste();
            }
            else
                cargarAlert('@SharedLocalizer["sinLineas"]');

        }

    }


    function guardarLinea() {

        if (validarLinea()) {
             var model = {
                 id: 0,
                 idAjuste: @Model.Id,
                 idInventario: items.val(),
                 descripcion: descripcionLinea.val(),
                 movimiento: movimiento.val(),
                 cantidad: cantidad.val(),
                 costoPromedio: costoPromedio.val(),
                 totalMovimiento: total.val(),
                 idCuentaContable: cuentaContable.val(),
                 idCentroGastos: cuentaCosto.val(),
                 cuentaContable: $('#cuentaContable option:selected').text().replace(/ /g, ""),
                 cuentaCosto: $('#cuentaCosto option:selected').text().replace(/ /g, ""),
                 nombreItem: $('#items option:selected').text().replace(/ /g, " "),       
            };

             var model2 = {
                 id: 0,
                 idAjuste: @Model.Id,
                 idInventario: items.val(),
                 descripcion: descripcionLinea.val(),
                 movimiento: movimiento.val(),
                 cantidad: cantidad.val().toString().replace(/\./g, ','),
                 costoPromedio: costoPromedio.val().toString().replace(/\./g, ','),
                 totalMovimiento: total.val().toString().replace(/\./g, ','),
                 idCuentaContable: cuentaContable.val(),
                 idCentroGastos: cuentaCosto.val(),
                 cuentaContable: $('#cuentaContable option:selected').text().replace(/ /g, ""),
                 cuentaCosto: $('#cuentaCosto option:selected').text().replace(/ /g, ""),
                 nombreItem: $('#items option:selected').text().replace(/ /g, ""),       
             };

            if (!existeItem(model.idInventario, model.movimiento)) {
                recalcularExistencias(model);
                lineas.push(model);               
                cargarTabla(lineas);
                console.log(model);
                lineasAgregadas.push(model2);
            }
            else
                cargarAlert('@SharedLocalizer["duplicacionValid"]');
        }

    }

    function eliminarLinea(_id, idLinea) {

        bootbox.confirm("@SharedLocalizer["confirmEliminarLinea"]", function (result) {

            if (result) {

                var id = _id - 1;

                if (validarExistencia(id)) {
                    if (idLinea != 0)
                        lineasEliminadas.push(lineas[id].id);
                    else
                        lineasAgregadas.splice($.inArray(lineas[id], lineasAgregadas), 1);

                    //la linea hay que convertirla a salida para que se reste
                    lineas[id].movimiento = "false";
                    recalcularExistencias(lineas[id]);

                    lineas.splice(id, 1);

                    console.log(lineasAgregadas);

                    cargarTabla(lineas);
                }


            }

        });


    }


    function validarLinea() {

        var flag = true;

        if (descripcionLinea.val().replace(/ /g, "") === "") {
            flag = false;
            cargarAlert('@SharedLocalizer["lineaSinDescripcion"]');
        }
        else {
            if (movimiento.val() === "false" && getItem(items.val())[0].existenciaBodega < parseInt(cantidad.val())) {
                flag = false;
                cargarAlert('@SharedLocalizer["cantidaMayorQueExistencias"]');
            }
        }


        return flag;

    }

    function validarExistencia(idlinea) {

        var salida = "";
        var linea = lineas[idlinea];

        if (linea.movimiento === "true") {

            console.log(linea);

            for (var i = 0; i < lineas.length; i++) {
                if (lineas[i].idInventario === linea.idInventario && lineas[i].movimiento === "false")
                    salida = lineas[i];
            }
            console.log(salida);
            if (salida === "")
                return true;
            else {
                var item = getItem(parseInt(linea.idInventario))[0];

                console.log(item);

                var existencia = item.existenciaBodega - parseInt(linea.cantidad);

                console.log(existencia);

                if (existencia >= parseInt(salida.cantidad))
                    return true;
                else {

                    cargarAlert("@SharedLocalizer["noPuedeEliminarlinea"]");
                    return false;
                }
            }

        }

        else
            return true;



    }

    function cargarLineas(array) {

        var data = array.tbPrAjusteInventario;

        for (var i = 0; i < data.length; i++) {
            var model = {
                id: data[i].id,
                idAjuste: @Model.Id,
                idInventario: data[i].idInventario,
                descripcion: data[i].descripcion,
                movimiento: data[i].movimiento.toString(),
                cantidad: data[i].cantidad,
                costoPromedio: data[i].costoPromedio,
                totalMovimiento: data[i].totalMovimiento,
                idCuentaContable: data[i].idCuentaContableNavigation.id,
                idCentroGastos: data[i].idCentroGastosNavigation.id,
                cuentaContable: data[i].idCuentaContableNavigation.cuentaContable,
                cuentaCosto: data[i].idCentroGastosNavigation.nombre,
                nombreItem: data[i].idInventarioNavigation.descripcion
            };

            lineas.push(model);
        }

        cargarTabla(lineas);

    }

    function getBodegasInventario() {

          $.ajax({
              type: "get",
              headers: {
                  "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
              },
              dataType: "json",
              url: '@Url.Action("GetBodegaInventario", "AjusteInventario")',
              success: function (data) {
                  bodegas = data;
                  cargarBodegas(data);
               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
          });
    }

    $("#bodegas").change(function () {

        for (var i = 0; i < bodegas.length; i++) {
            if (bodegas[i].id === parseInt($(this).val()))
                cargarItems(bodegas[i].tbPrInventarioBodega);
        }

    });

    costoPromedio.on('keyup, change, focusout', function () {

        calcularTotalMovimiento();

    });

    cantidad.on('focusout', function () { if ($(this).val() === "") cantidad.val(1); });

    movimiento.change(function () {

        console.log($(this).val());

        if ($(this).val() === "true") costoPromedio.attr('disabled', false);
        else
            costoPromedio.attr('disabled', true);
    });

    fechaDocumento.on('keyup', function () {
        $('#fechaPicker').datetimepicker('defaultDate', new Date());
    });



    cantidad.on("keyup, change", function () {

        if (parseInt(cantidad.val()) < 1)
            cantidad.val(1);

        calcularTotalMovimiento();

    });

    function cargarTabla(data) {
        $('.filasCargadas').remove();

        contadorFila = 0;

        for (var i = 0; i < data.length; i++) {
            contadorFila++;
            var body = '<tr class="filasCargadas" id="fila' + contadorFila + '"><td style="padding-top:2rem;">' + data[i].nombreItem + '</td>'
                + '<td style="padding-top:2rem;">' + data[i].descripcion + '</td>'
                + '<td style="padding-top:2rem;">' + getMovimiento(data[i].movimiento) + ' </td>'
                + '<td style="padding-top:2rem;">' + data[i].cantidad + '</td>'
                + '<td style="padding-top:2rem;"><input style="border:0; background-color : #F7F7F7" class="currency" value="' + data[i].costoPromedio + '"/></td>'
                + '<td style="padding-top:2rem;"><input style="border:0; background-color : #F7F7F7" class="currency" value="' + data[i].totalMovimiento + '"/></td>'
                + '<td style="padding-top:2rem;">' + data[i].cuentaContable + '</td>'
                + '<td style="padding-top:2rem;">' + data[i].cuentaCosto + '</td>'
                + '<td><button  @estado class="btn btn-link" value="' + contadorFila + '" onclick="eliminarLinea(value, ' + data[i].id + ')" ><i class="fas fa-trash"></i></button></td></tr>';

            $('.lineaForm').before(body);

        }

        $(".currency").inputmask('currency', {
            prefix: "₡",
            rightAlign: true
        });

        calcularTotales();
        inicializaTabla();
        inicializaCampos(data[data.length -1]);
        
    }

    function cargarBodegas(data) {


        for (var i = 0; i < data.length; i++) {
            var o = new Option(data[i].nombre, data[i].id);
            if (data[i].id === @Model.IdBodega)
                $(o).attr('selected', true);
            $("#bodegas").append(o);
        }

        cargarItems(data[0].tbPrInventarioBodega);
    }

    function cargarItems(data) {

        arrayInventario = data;

        $('#items option').remove();

        arrayItems = [];

        for (var i = 0; i < data.length; i++) {
            var o = new Option(data[i].idInventarioNavigation.codigo + ' - ' + data[i].idInventarioNavigation.descripcion, data[i].idInventarioNavigation.idInventario);
            items.append(o);
            //$('#items').selectpicker('refresh');
            arrayItems.push(data[i].idInventarioNavigation);
        }

        $('#items').select2({ width: null, language: localStorage.getItem("idioma") });
        cargarCostoPromedio(arrayItems);




    }

    function cargarCostoPromedio(data) {
        for (var i = 0; i < data.length; i++) {
            if (parseInt(items.val()) === data[i].idInventario) {
                costoPromedio.val(data[i].costoPromedioGeneral);
                break;
            }
        }

       calcularTotalMovimiento();
    }
    function calcularTotalMovimiento() {

        var res = parseFloat(cantidad.val()) * parseFloat(costoPromedio.val());
        if (cantidad.val() === '')
            res = 1 * parseFloat(costoPromedio.val());
        total.val(res);
    }

    function getItem(id) {

        var it = [];
        for (var i = 0; i < arrayInventario.length; i++) {
            if (arrayInventario[i].idInventarioNavigation.idInventario === parseInt(id))
                it.push(arrayInventario[i]);
        }

        return it;
    }

    function existeItem(id, mov) {

        var flag = false;
        for (var i = 0; i < lineas.length; i++) {

            if (parseInt(lineas[i].idInventario) === parseInt(id) && lineas[i].movimiento.toString() === mov)
                flag = true;
        }
        return flag;
    }

    function getMovimiento(key) {
        if (key === "true")
            return "@SharedLocalizer["Entrada"]";
        else
            return "@SharedLocalizer["Salida"]";
    }

    function calcularTotales() {

        $entradas.val("");
        $salidas.val("");
        entradas = 0;
        salidas = 0;


        for (var i = 0; i < lineas.length; i++) {
            if (lineas[i].movimiento === "true")
                entradas += parseFloat(lineas[i].totalMovimiento);
            else
                salidas += parseFloat(lineas[i].totalMovimiento);
        }

        $entradas.val(entradas);
        $salidas.val(salidas);
        saldo = entradas - salidas;
        $saldo.val(saldo);
    }

    function recalcularExistencias(linea) {

        console.log(linea);

        var item = getItem(parseInt(linea.idInventario))[0];

        if (linea.movimiento === "true") {
            item.existenciaBodega += parseInt(linea.cantidad);
        }
        else if (linea.movimiento === "false") {
            item.existenciaBodega -= parseInt(linea.cantidad);
        }

    }

    function inicializaTabla() {

    }

    function guardarAjuste() {

        $.ajax({
              type: "POST",
              headers: {
                  "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
              },
              dataType: "json",
            url: '@Url.Action("CrearEditarAjuste", "AjusteInventario")',
            data: crearModelo(),
            success: function (data) {
                //console.log(data);
                window.location.href = "@Url.Action("ListarAjustes","AjusteInventario")";
               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
        });

    }
    function editarAjuste() {

        $.ajax({
              type: "POST",
              headers: {
                  "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
              },
              dataType: "json",
            url: '@Url.Action("CrearEditarAjuste", "AjusteInventario")',
            data: crearModeloEditar(),
            success: function (data) {
                //console.log(data);
                if (lineasAgregadas.length > 0)
                    guardarAjusteInventario();
                if (lineasEliminadas > 0)
                    eliminarAjusteInventario();

                window.location.href = "@Url.Action("ListarAjustes","AjusteInventario")";
               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
        });




    }

    function guardarAjusteInventario() {

        $.ajax({
            type: "POST",
            headers: {
                "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
            },
            dataType: "json",
            url: '@Url.Action("CrearAjusteInventario", "AjusteInventario", new { idBodega = Model.IdBodega })',
            data: { viewModel: lineasAgregadas},
            success: function (data) {
                //console.log(data);

               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
          });
    }
    function eliminarAjusteInventario() {
        $.ajax({
            type: "POST",
            headers: {
                "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
            },
            dataType: "json",
            url: '@Url.Action("EliminarAjusteInventario", "AjusteInventario", new { idAjuste = Model.Id })',
            data: { id: lineasEliminadas },
            success: function (data) {
               // console.log(data);

               },
              error: function (err, scnd) {
                  cargarAlert('@SharedLocalizer["errorGeneral"]');
                  console.log(err.statusText);
              }
          });
    }

    function crearModelo() {


        var frm = frmAjuste.serializeArray();



        var ajusteModel = {
              id: @Model.Id,
            anulada: frm[1].value,
            totalEntrada: entradas,
            totalSalida: salidas,
            saldoAjuste: saldo,
            idUsuario: frm[2].value,
            idBodega: $('#bodegas').val(),
            descripcion: frm[4].value,
            fechaDocumento: fechaDocumento.val(),
            ajusteInventario: lineas
        };

        return ajusteModel;

    }

    function crearModeloEditar() {


        var frm = frmAjuste.serializeArray();

        var ajusteModel = {
            id: @Model.Id,
            anulada: frm[1].value,
            totalEntrada: entradas,
            totalSalida: salidas,
            saldoAjuste: saldo,
            idUsuario: frm[2].value,
            idBodega: $('#bodegas').val(),
            descripcion: frm[4].value,
            fechaDocumento: fechaDocumento.val(),
            ajusteInventario: null
        };

        return ajusteModel;

    }
    function validarCampos() {

        console.log(frmAjuste.serializeArray());

        var frm = frmAjuste.serializeArray();
        if (frm[4].value.replace(/ /g, "") === "") {
            $('#descripcionAjusteValid').attr('hidden', false);
            return false;
        }
        return true;
    }

    function inicializaCampos(linea) {

        //console.log(linea);
        $('#items').trigger('change.select2');
        descripcionLinea.val("");
        cantidad.val(1);
        calcularTotalMovimiento();

        if (linea != undefined)
            movimiento.val(linea.movimiento);
    }

    function cancelar() {
        bootbox.confirm("@SharedLocalizer["confirmCancelar"]", function (result) {

            if (result)
                window.location.href = "@Url.Action("ListarAjustes","AjusteInventario")";

        });
    }

    function anularAjuste() {

        bootbox.prompt({
            title: "@SharedLocalizer["confirmAnularAjuste"]",
            message: '<p>@SharedLocalizer["Justificación"]</p>',
            inputType: 'textarea',
            callback: function (result) {
                
                if (result.replace(/ /g, "") != "") {

                    cargarJustificacion(result);
                    $.ajax({
                        type: "get",
                        headers: {
                            "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                        },
                        dataType: "json",
                        url: '@Url.Action("AnularAjuste", "AjusteInventario", new { id = Model.Id })',
                        success: function (data) {
                            cargarJustificacion(result);
                            cargarAlert('@SharedLocalizer["AjusteAnulado"]');
                            window.location.href = "@Url.Action("ListarAjustes","AjusteInventario")";

                        },
                        error: function (err, scnd) {
                            cargarAlert('@SharedLocalizer["errorGeneral"]');
                            console.log(err.statusText);
                        }
                    });

                }
                else
                    cargarAlert('@SharedLocalizer["JustificacionInvalida"]');
            }
        });

    }
    function validaAnulacion() {

        if ('@Model.Anulada' === 'True') {
            $('input').attr('readonly', 'readonly');
            $('textarea').attr('disabled', 'true');
            $('select').attr('disabled', 'true');
            $('.btnAccion').attr('disabled', 'true');           
        }
            

    }

    function cargarJustificacion(mensaje) {
        setMensajeFromOut(mensaje);
    }

</script>


