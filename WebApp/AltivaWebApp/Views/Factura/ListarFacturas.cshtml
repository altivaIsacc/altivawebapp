@model IEnumerable<AltivaWebApp.Domains.TbFdFactura>
@inject IStringLocalizer<SharedResources> Lb
@{
    ViewData["Title"] = "Facturas";
}



<div class="row">
    <div class="col-md-2 col-md-3 col-xs-6">
        <h3>@Lb["Facturas"]</h3>
    </div>
    <div class="col-md-4 col-md-7 col-xs-5" style="margin-left:1rem; padding-top:0.7rem">
        <p>
            <a asp-action="CrearFactura" class="btn btn-primary"><span>@Lb["Agregar"] </span>&nbsp;<i class="fas fa-plus-circle"></i></a>
        </p>
    </div>
</div>

<div class="table-responsive">
    <table id="tblFacturas" class="table table-bordered">
        <thead>
            <tr>
                <th>
                    @Lb["N."]
                </th>
                <th>
                    @Lb["Tipo"]
                </th>
                <th>
                    @Lb["Fecha"]
                </th>
                <th>
                    @Lb["Cliente"]
                </th>
                <th>
                    @Lb["Estado"]
                </th>

                <th>@Lb["Acción"]</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>

    var facturas = [];

    $(function () {

        getFacuras();

    });

    function getFacuras() {
           
        $.ajax({
            type: "get",
            dataType: "json",
            url: '@Url.Action("GetAllFacturas", "Factura")',
            success: function (data) {
                console.log(data);
                facturas = JSON.parse(JSON.stringify(data));
                cargarFiltros();
            },
            error: function (err, scnd) {
                cargarAlert('@Lb["errorGeneral"]');
                console.log(err.statusText);
            }
        });
    }

    function cargarDatos(data) {
       
        $("#tblFacturas > tbody").remove();
        $('#tblFacturas').append('<tbody></tbody>');

        var contadorFila = 0;

        for (var i = 0; i < data.length; i++) {


            var body = '<tr class="fila' + contadorFila + ' filas">'
                + '<td><a href="' + "@Url.Action("EditarFactura", new { id = "__id__" })".replace("__id__", data[i].id) + '" >' + data[i].id + '</a></td>'
                + '<td><p>' + getTipo(data[i].tipo) + '</p></td>'
                + '<td><p>' + recuperarFecha(data[i].fechaFactura) + '</p></td>'
                + '<td><p>' + getNombreContacto(data[i].idClienteNavigation) + '</p></td>'
                + '<td><p>' + data[i].estado + '</p></td>'
                + '<td><a href="' + "@Url.Action("EditarFactura", new { id = "__id__" })".replace("__id__", data[i].id) + '" style="font-size:1.8rem;" onclick="editarFactura(' + data[i].id + ')" ><i class="fas fa-edit"></i></a></td></tr>';
            $('#tblFacturas > tbody').append(body);
            contadorFila++;
        }



        //inicializarTabla();

    }
    function cargarFiltros() {

        facturasFiltrado = facturas;//JSON.parse(JSON.stringify(ordenes));

        //facturasFiltrado = filtroAnuladas(comprasFiltrado);

        //facturasFiltrado = filtroFecha(comprasFiltrado, desde, hasta);

        cargarDatos(facturasFiltrado);

    }
    function getTipo(tipo) {
        if (tipo === 1)
            return "@Lb["Contado"]";
        else
            return "@Lb["Crédito"]";
    }

    function getNombreContacto(data) {
        if (data.nombre === "0" && data.apellidos === "0") {
            return "@Lb["ClienteContado"]";
        }
        if (data.empresa)
            return data.nombreComercial;
        else
            return data.nombre + ' ' + data.apellidos;

    }
    function recuperarFecha(_fecha) {


        var f = new Date(_fecha);
        return f.toLocaleString();

    }

</script>