
@model AltivaWebApp.ViewModels.ContactoViewModel

@{
    ViewData["Title"] = "Crear Contacto";
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
<input type="text" value="@Model.Id" id="id" hidden />
<div><partial name="~/Views/Contacto/nuevo.cshtml" model=" @Model" /></div>
<style>
    .disabledTab {
        pointer-events: none;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
<!-- The Modal -->
<div class="modal fade" id="cuentasBancarias">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>

            </div>
            <div hidden>
                <input type="text" id="ContactoCuentas" asp-for="Id" />
            </div>
            <!-- Modal body -->
            <div class="modal-body" id="agregarCuentas">


            </div>



        </div>
    </div>

</div>
<script>

  
     //getcuentasBancarias by contacto
    function GetCuentasContacto(idContacto) {
        $.ajax({
            headers: {
                "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
            },
            type: "GET",


            url: '@Url.Action("GetCuentasByContacto", "Contacto")',
        

            data: { idContacto: idContacto },
            success: function (data) {
                if (data != false) {
                    var cuentas = JSON.parse(JSON.stringify(data));
                    cargarTablaCuenta(cuentas);
                }
                    }
        });
    }
    function cargarTablaCuenta(data) {
        $("#tablaCuentasBancarias > tbody").remove();
        $('#tablaCuentasBancarias').append('<tbody></tbody>');
        for (var i = 0; i < data.length; i++) {
            var body = '<tr>'
                + '<td >' + data[i].tipoCuenta + '</td>'
                + '<td >' + data[i].cuentaBancaria + '</td>'
                + '<td >' + data[i].banco + '</td>'
                + '<td >' + data[i].moneda + '</td>'
                + '<td>  <button value="' + data[i].id + '" onclick="editarCuenta(' + data[i].id + ')" class="btn btn-link btnEditar"><i class="fas fa-edit"></i></button><button value="' + data[i].id + '" onclick="EliminarCuenta(' + data[i].id + ')" class="btn btn-link"> <i class="fas fa-trash"></i></button></td></tr>';
            $('#tablaCuentasBancarias > tbody').append(body);

        }


        $('#tablaCuentasBancarias').DataTable().destroy();
        tabla=$('#tablaCuentasBancarias').DataTable({
            dom: 'Bfrtip',
            "bDestroy": true,
           

            language: {
                "decimal": "",
                "emptyTable": "No hay información",

                "infoPostFix": "",
                "thousands": ",",

                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "<a ><i  class='fas fa-search ' ></i></a>",
                "zeroRecords": "Sin resultados encontrados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            },
            buttons: [
                {
                    extend: 'copyHtml5',
                    text: '<i class="fas fa-copy   " ></i>',
                    titleAttr: 'Copy',
                    title: 'tareas',
                    pageSize: 'LEGAL'

                },
                {
                    extend: 'excelHtml5',
                    text: '<i class="fas fa-file-excel  "></i>',
                    titleAttr: 'Excel',
                    title: 'tareas',
                    pageSize: 'LEGAL'

                },

                {
                    extend: 'pdfHtml5',
                    text: '<i class="fas fa-file-pdf   "></i>',
                    titleAttr: 'PDF',
                    title: 'Tareas',
                    pageSize: 'LEGAL',
                    orientation: 'landscape',
                }
            ]
          
        });

    }
    //elimnar cuentas:
    function EliminarCuenta(idCuenta) {
        bootbox.confirm({

            message: "<h4 class='text-center'><span >Esta usted seguro que desea continuar?</span></h4>",
            buttons: {

                confirm: {
                    label: '<i class="fa fa-check"></i> Aceptar'
                },
                cancel: {
                    label: '<i class="fa fa-times"></i> Cancelar'
                }
            },
            callback: function (result) {
                if (result) {
                    $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "DELETE",


                    url: '@Url.Action("DeleteCuentasBancarias", "Contacto")',

             data: { idCuenta: idCuenta },

                    success: function (data) {
                       
                        GetCuentasContacto(@Model.Id);
                        return false;
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }
        });
                } else {
                    return;
                }
            }
        });
        
    }
    //editar cuentas
    function editarCuenta(idCuenta) {
          $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "GET",


                    url: '@Url.Action("PartialEditarTipoCuentaBancaria", "Contacto")',

              data: { idCuenta: idCuenta },

                    success: function (data) {
                        $('#cuentasBancarias').modal('show');
                        $('#agregarCuentas').html(data);
                      
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }
        });
    }
</script>
<script>
     //cargar tabla
    function cargarTabla() {
        $.ajax({
                    type: "get",
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },

                    url: '@Url.Action("GetTareas", "Contacto")',


            data: { idContacto:@Model.Id },


            success: function (data) {
                if (data != false) {
                    contactoTareas = JSON.parse(JSON.stringify(data));

                    cargarDatos(contactoTareas);
                }
                },
            error: function (err, scnd) {
                console.log(err.statusText);
                alert('error');
                }
            });
    }
    //cargar datos de las tareas..
    function cargarDatos(data) {
        var contadorFila = 0;
        var fecha1 = ""
        var fecha = "";

        $("#TablaTareasContacto > tbody").remove();
        $('#TablaTareasContacto').append('<tbody></tbody>');
        dt = new Date();
        fecha = +dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear() + " " + 0 + 0 + ":" + 0 + 0 + ":" + 0 + 0;
        fecha1 = +dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear();
        var color = "";
        var icono = "";
        var icono2 = "";

        for (var i = 0; i < data.length; i++) {


            if (recuperarFecha(data[i].fechaLimite) > fecha) {

                color = "";
            } else
                if (recuperarFecha(data[i].fechaLimite) < fecha) {

                    color = "#dc4a46";
                }
                else

                    if (recuperarFechaSinHora(data[i].fechaLimite) == fecha1) {

                        color = "#f3da0b";
                    } else {
                        color = "";
                    }

            var body = '<tr class="fila' + contadorFila + ' filas">'
                + '<td>' + data[i].titulo + '</td>'
                + '<td>' + data[i].idUsuario + ' </td>'
                + '<td>' +" @Model.Correo" + '</td>'
                + '<td bgColor="' + color + '">' + recuperarFecha(data[i].fechaLimite) + '</td>'
                + '<td ><div style="background:' + data[i].idEstadoNavigation.color + ';color:white;">' + data[i].idEstadoNavigation.titulo + '</div></td>'
                + '<td ><div  style="background: ' + data[i].idTipoNavigation.color + '; color:white;">' + data[i].idTipoNavigation.titulo + '</div></td>'

            $('#TablaTareasContacto > tbody').append(body);
            contadorFila++;
        }
        $('#TablaTareasContacto').DataTable().destroy();

        TablaTareas = $('#TablaTareasContacto').DataTable({

            info: false,

            "ordering": false,

            language: {
                "decimal": "",
                "emptyTable": "NoDatos",
                "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                "infoPostFix": "",
                "thousands": ",",
                "lengthMenu": "Mostrar _MENU_Entradas",
                "loadingRecords": "Cargando...",
                "processing": "Procesando...",
                "search": "<i class='fas fa-search'></i>",
                "zeroRecords": "sinResultados",
                "paginate": {
                    "first": " Primero",
                    "last": "Último",
                    "next": "Sguiente]",
                    "previous": "Anterior"
                }
            }
        });
    }


    if ($("#pais").val() == "CostaRica") {

        $("#provincia").prop("disabled", false);
        $("#canton").prop("disabled", true);
        $("#distrito").prop("disabled", true);
        $('.provin').remove();
        $('.canton').remove();
        $('.distrito').remove();
              $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Provincias", "Contacto")',



                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if (data[i].idProvincia == @Model.Provincia) {
                                $("#provincia").append('<option class="provin" selected="selected" value=' + data[i].idProvincia + '>' + data[i].descProvincia + ' </option>');
                            } else {
                                $("#provincia").append('<option class="provin"  value=' + data[i].idProvincia + '>' + data[i].descProvincia + ' </option>');

                            }
                            $("#provincia").prop("disabled", false);
                        }


                    }
        });
         $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Cantones", "Contacto")',

          data: { idProvincia : @Model.Provincia},

                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if (data[i].idCanton == @Model.Canton) {
                                $("#canton").append('<option class="canton" selected="selected" value=' + data[i].idCanton + '>' + data[i].descCanton + ' </option>');
                            }
                            else {
                                $("#canton").append('<option class="canton"  value=' + data[i].idCanton + '>' + data[i].descCanton + ' </option>');
                            }
                            $("#canton").prop("disabled", false);
                        }

                }
        });
          $('.distrito').remove();
      $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Distritos", "Contacto")',

          data: { idDistrito: @Model.Canton, idProvincia: @Model.Provincia},

                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if (data[i].idDistrito == @Model.Distrito) {
                                $("#distrito").append('<option class="distrito" selected="selected" value=' + data[i].idDistrito + '>' + data[i].descDistrito + ' </option>');
                            } else {
                                $("#distrito").append('<option class="distrito"  value=' + data[i].idDistrito + '>' + data[i].descDistrito + ' </option>');

                            }
                        }


                        $("#distrito").prop("disabled", false);
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }

                });


    }
</script>
<script>
   
      
      function GetCondicionesClientes() {
$.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "GET",


                    url: '@Url.Action("GetCondicionesPago", "Contacto")',

    data: { idContacto:@Model.Id},

                    success: function (data) {
                        if (data != false) {
                            for (var i = 0; i < data.length;i++) {
                                if (data[i].esCliente == true) {
                                    $('#plazoCliente').val(data[i].plazoCredito);
                                    $('#montoCliente').val(data[i].montoMaximo);
                                    $('#IdConCliente').val(data[i].id);
                                } else if (data[i].esProveedor == true){
                                    $('#plazoProveedor').val(data[i].plazoCredito);
                                    $('#montoProveedor').val(data[i].montoMaximo);
                                    $('#IdConProveedor').val(data[i].id);
                                }
                            }
                        }
                    }
        });
    }
    $(function () {
        GetCondicionesClientes();
        if ($("#combo").val() == "CedulaFisica") {
            $("#fisica").attr('required', '');
            $("#dimex").val("");

            $("#dimex").attr('required', false);
            $("#nite").attr('required', false);
            $("#cedFisica").show();
            $("#cedJuridica").hide();
            $("#cedDimex").hide();
            $("#cedNite").hide();
        } else if ($("#combo").val() == "CedulaJuridica") {

            $("#fisica").val("");

            $("#fisica").attr('required', false);
            $("#cedFisica").hide();
            $("#cedJuridica").show();
            $("#cedDimex").hide();
            $("#cedNite").hide();

            $("#dimex").attr('required', false);
            $("#nite").attr('required', false);

        } else if ($("#combo").val() == "Dimex") {
            $("#dimex").attr('required', '');
            $("#juridica").attr('required', false);
            $("#fisica").attr('required', false);
            $("#nite").attr('required', false);
            $("#cedDimex").show();
            $("#cedFisica").hide();
            $("#cedJuridica").hide();

            $("#cedNite").hide();
        } else if ($("#combo").val() == "NITE") {
            $("#nite").attr('required', '');

            $("#juridica").attr('required', false);
            $("#dimex").attr('required', false);
            $("#fisica").attr('required', false);
            $("#cedNite").show();
            $("#nite").val("");
            $("#cedFisica").hide();
            $("#cedJuridica").hide();
            $("#cedDimex").hide();
            $("#cedNite").show();
        }
    });

</script>
<script type="text/javascript">

    $('#tel').mask('00000000');
    $('#fisica').mask('0-0000-0000');
    $('#juridica').mask('0-0000-00000');
    $('#dimex').mask(' 000000000000');
    $('#nite').mask('0000000000');
    $(function () {
        $('[href="#menu1"]').removeClass('disabledTab');
        $('[href="#contactoComentarios"]').removeClass('disabledTab');
        $('[href="#contactostTareas"]').removeClass('disabledTab');


        $("#btnNuevo").hide();
        $('#divBotones').append('<button type="submit" id="btnEditar" class="btn btn-success" onclick="editar()">Guardar <i style="font-size:2rem;" class="fas fa-save"></i></button> <button  class="btn btn-default  btnAtras">Cancelar</button>');
             $('.atras').on('click', function () {
                       var urls = '@Url.Action("Index", "Contacto", new { palabra = "__id__"})';
                                    window.location.href = urls.replace('__id__', "All");

        });

        if ($("#radio").is(':checked')) {

            $("#nombre").show();
            $("#NombreJuridico").attr('required', false);
            $("#comercial").attr('required', false);
            $("#comercial").hide();


            $("#Nombre").attr('required', '');
            $("#Apellidos").attr('required', '');
            $("#apellidos").show();
            $("#NombreComercial").attr('required', false);

            $("#juridico").hide();


        } else if ($("#radio1").is(':checked')) {

            $("#nombre").hide();
            $("#comercial").show();

            $("#Apellidos").attr('required', false);
            $("#Nombre").attr('required', false);
            $("#NombreComercial").attr('required', '');
                        $("#apellidos").hide();

            $("#juridico").show();
            $("#NombreJuridico").attr('required', '');
        }


    });
    $(document).ready(function () {
        cargarTabla();
        $('#pais').change(function () {
            if ($(this).val() == "CostaRica") {

      $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Provincias", "Contacto")',



                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {

                            $("#provincia").append('<option class="provin" value=' + data[i].idProvincia + '>' + data[i].descProvincia+' </option>');
                        }

                        $("#provincia").prop("disabled", false);
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }

                });

            } else if ($(this).val() != "CostaRica") {
                $("#provincia").prop("disabled", true);
                $("#canton").prop("disabled", true);
                $("#distrito").prop("disabled", true);
                $('.provin').remove();
                $('.canton').remove();
                $('.distrito').remove();
            }

        });
        $('#provincia').change(function () {

            $('.canton').remove();
      $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Cantones", "Contacto")',

          data: { idProvincia : $(this).val()},

                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {

                            $("#canton").append('<option class="canton" value=' + data[i].idCanton + '>' + data[i].descCanton+' </option>');
                        }


                        $("#canton").prop("disabled", false);
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }
        });

        });

        $('#canton').change(function () {


      $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "POST",


                    url: '@Url.Action("Distritos", "Contacto")',

          data: { idDistrito: $(this).val(), idProvincia: $('#provincia').val()},

                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {

                            $("#distrito").append('<option class="distrito" value=' + data[i].idDistrito + '>' + data[i].descDistrito+' </option>');
                        }


                        $("#distrito").prop("disabled", false);
                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }

                });

        });
        $('#combo').change(function () {
            if ($(this).val() == "CedulaJuridica") {
                $("#juridica").attr('required', '');
                $("#fisica").attr('required', false);

                $("#dimex").attr('required', false);
                $("#nite").attr('required', false);
                $("#juridica").val("");
                $("#cedFisica").hide();
                $("#cedJuridica").show();
                $("#cedDimex").hide();
                $("#cedNite").hide();
                $("#nombreAlert6").empty();
            } else if ($(this).val() == "CedulaFisica") {
                $("#fisica").attr('required', '');
                $("#juridica").attr('required', false);
                $("#dimex").attr('required', false);
                $("#nite").attr('required', false);
                $("#nombreAlert5").empty();
                $("#fisica").val("");
                $("#cedFisica").show();
                $("#cedJuridica").hide();
                $("#cedDimex").hide();
                $("#cedNite").hide();
            } else if ($(this).val() == "Dimex") {
                $("#dimex").attr('required', '');
                $("#juridica").attr('required', false);
                $("#fisica").attr('required', false);
                $("#nite").attr('required', false);
                $("#cedDimex").show();
                $("#cedFisica").hide();
                $("#cedJuridica").hide();
                $("#nombreAlert7").empty();
                $("#dimex").val("");
                $("#cedNite").hide();
            } else if ($(this).val() == "NITE") {
                $("#nite").attr('required', '');

                $("#juridica").attr('required', false);
                $("#dimex").attr('required', false);
                $("#fisica").attr('required', false);
                $("#cedNite").show();
                $("#nombreAlert8").empty();
                $("#nite").val("");
                $("#cedFisica").hide();
                $("#cedJuridica").hide();
                $("#cedDimex").hide();
                $("#cedNite").show();
            }
        });
    });




</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
<script>
    $(' input[type=radio]').change(function () {
        if ($(this).val() == "Persona") {
            $("#nombre").show();

            $("#NombreJuridico").attr('required', false);
            $("#NombreJuridico").val("");
            $("#comercial").attr('required', false);
            $("#comercial").val("");
            $("#comercial").hide();


            $("#Nombre").attr('required', '');
            $("#Apellidos").attr('required', '');
            $("#apellidos").show();
            $("#NombreComercial").attr('required', false);
            $("#NombreComercial").val("");

            $("#juridico").hide();

        } else {

            $("#nombre").hide();

            $("#comercial").show();

            $("#Apellidos").attr('required', false);
            $("#Apellidos").val("")
            $("#Nombre").attr('required', false);
            $("#Nombre").val("");
            $("#NombreComercial").attr('required', '');
            $("#apellidos").hide();
            $("#apellidos").val("");

            $("#juridico").show();
            $("#NombreJuridico").attr('required', '');

        }
    });

</script>
<script>
    var j = 0;
    var k = 0;
    var y = 0;
    var t = 0;


    $(document).ready(function () {

        $('#btnAgregarCuentas').attr('disabled', false);
       GetCuentasContacto(@Model.Id);
     $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "GET",


                    url: '@Url.Action("Usuarios", "Contacto")',



                    success: function (data) {

                        for (var i = 0; i < data.length; i++) {

                            if (data[i].id == @Model.IdUsuario) {
                                $("#usuarioEncargado").append('<option selected="selected"  value=' + data[i].id + '>' + data[i].nombre + ' </option>');
                            } else {
                                $("#usuarioEncargado").append('<option value=' + data[i].id + '>' + data[i].nombre + ' </option>');

                            }




                        }




                    }

                });

          $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "GET",
              data: {id:@Model.Id},

                    url: '@Url.Action("camposEdit", "Contacto")',


                    success: function (data) {

                        cargarCamposPersonalizados(data);


                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }

        });

    });

    function cargarCamposPersonalizados(data) {
        for (var i = 0; i < data.length; i++) {
            if (data[i].tipo == 'textArea') {
                if (data[i].valor != null) {
                    $("#ul").append('<li> <div class="form-group"><input id="id' + k + '" type="text" asp-for="idTextoGrande[]" name="idTextoGrande[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + '&nbsp;</label><textArea id="' + j + '" class="form-control" asp-for="textoGrande[]" >' + data[i].valor + '</textArea></div></li>');
                } else {
                    $("#ul").append('<li> <div class="form-group"><input id="id' + k + '" type="text" asp-for="idTextoGrande[]" name="idTextoGrande[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + '&nbsp;</label><textArea id="' + j + '" class="form-control" asp-for="textoGrande[]" ></textArea></div></li>');

                }
                j++; k++;
            } else if (data[i].tipo == 'checkbox') {
                if (data[i].valor == "on") {
                    $("#ul").append('<li><input id="idc' + t + '"  type="text" asp-for="idChechBox[]" name="idChechBox[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + ':</label>&nbsp;<input  id="c' + y + '" asp-for="checkbox[]" name="checkbox" type="checkbox" checked="checked" /></li>');
                } else {
                    $("#ul").append('<li><input id="idc' + t + '"  type="text" asp-for="idChechBox[]" name="idChechBox[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + ':</label>&nbsp;<input  id="c' + y + '" asp-for="checkbox[]" name="checkbox" type="checkbox"  /></li>');

                }
                y++; t++;
            } else if (data[i].tipo == 'datetime-local') {

                if (data[i].valor == null) {
                    $("#ul").append('<li><div class="form-group"><input id="id' + k + '"  type="text" asp-for="idFecha[]" name="idFecha[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + ':</label>&nbsp; <input asp-for="Fechas[]" id="' + j + '" name="fechas[]" class="form-control  input-lg"  data-target="#datetimepicker1" type="' + data[i].tipo + '"/></div></li>');
                } else {
                    console.log();
                    var fecha = new Date(data[i].valor);

                    $("#ul").append('<li><div class="form-group"><input id="id' + k + '"  type="text" asp-for="idFecha[]" name="idFecha[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + ':</label>&nbsp; <input asp-for="Fechas[]" id="' + j + '" name="fechas[]" class="form-control  input-lg" value="' + data[i].valor + '" data-target="#datetimepicker1" type="' + data[i].tipo + '"/></div></li>');

                }

                j++; k++;
            } else if (data[i].tipo == 'lista') {
                $("#ul").append('<li><div class="form-group"><input id="id' + k + '"  type="text" asp-for="idFecha[]" name="idFecha[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + ':</label>&nbsp; <select id="' + j + '" class="form-control"><option hidden value="">Seleccione</option></select></div></li>');

                cargarPersonalizados(data[i].id, j, data[i].valor);
                j++; k++;
            }else {
                if (data[i].valor != null) {

                    $("#ul").append('<li> <div class="form-group"><input type="text" asp-for="idTexto[]" id="id' + k + '"  name="idTexto[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + '&nbsp;</label><input  asp-for="texto[]" id="' + j + '" name="texto[]"  class="form-control input-lg" value="' + data[i].valor + '"/></div></li>');
                } else {
                    $("#ul").append('<li> <div class="form-group"><input type="text" asp-for="idTexto[]" id="id' + k + '"  name="idTexto[]" hidden value="' + data[i].idCampoPersonalizados + '"/><Label>' + data[i].nombreCampo + '&nbsp;</label><input  asp-for="texto[]" id="' + j + '" name="texto[]"  class="form-control input-lg" /></div></li>');

                }
                j++; k++;
            }


        }
        }
    function cargarPersonalizados(id,j,valor) {
      $.ajax({
                    headers: {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                    type: "GET",


                    url: '@Url.Action("GetCampos", "ListaDesplegable")',

          data: {id:id},

                    success: function (data1) {

                        for (var i = 0; i < data1.length; i++) {
                            if (valor == data1[i].valor) {
                                $('#' + j + '').append('<option selected>' + data1[i].valor + '</option>');
                            } else {
                                $('#' + j + '').append('<option >' + data1[i].valor + '</option>');

                            }
                        }



                    },

                    error: function (err, scnd) {
                        console.log(err.statusText);
                    }

                });
    }
    function editar() {
        if (validarContactos() == true) {
            var nombreContacto = $('#Nombre').val();

            var apellidos = $('#Apellidos').val();
            var nombreComercial = $('#NombreComercial').val();
            var nombreJuridico = $('#NombreJuridico').val();
            if (nombreComercial != "") {
                nombreContacto = "";
            } else if (nombreContacto != "") {
                nombreComercial = "";
            }
            var tipoCedula = $('#combo').val();
            var fisica = $('#fisica').val();
            var id = $('#id').val();
            var juridica = $('#juridica').val();
            var dimex = $('#dimex').val();
            var nite = $('#nite').val();
            var telefono = $('#tel').val();
            var correo = $('#Correo').val();
            var pais = $('#pais').val();
            var provincia = $('#provincia').val();
            var canton = $('#canton').val();
            var distrito = $('#distrito').val();
            var idUsuario = $('#usuarioEncargado').val();
            var otrasSenas = $('#otrasSenas').val();
            var imagen = $('#imagen').val();

            var fileUpload = $("#imagen").get(0);

            var files = fileUpload.files;
            var formData = new FormData();
            formData.append('foto', $("#imagen")[0].files[0]);
            console.log(formData);
            var cliente = new Boolean(false);
            var proveedor = new Boolean(false);
            var WebLink = $('#WebLink').val();
            var MapLink = $('#MapLink').val();
            if ($("#cliente").prop('checked')) {

                cliente = true;


            } else {
                cliente = false;

            } if ($("#proveedor").prop('checked')) {

                proveedor = true;


            } else {
                proveedor = false;

            }

            var camposPersonalizados = [];
            var Contacto = [];

            var model2 = {
                id: id,
                nombre: nombreContacto,
                apellidos: apellidos,
                nombreComercial: nombreComercial,
                nombreJuridico: nombreJuridico,
                tipoCedula: tipoCedula,
                cedula: fisica,
                juridica: juridica,
                dimex: dimex,
                nite: nite,
                telefono: telefono,
                correo: correo,
                pais: pais,
                provincia: provincia,
                canton: canton,
                distrito: distrito,
                cliente: cliente,
                proveedor: proveedor,
                otrasSenas: otrasSenas,
                idUsuario: idUsuario,
                webLink: WebLink,
                mapLink: MapLink,
                idTipoCliente: $('#tipoClientes').val(),
                idFamiliaCliente: $('#familia').val(),
                idSubFamiliaCliente: $('#subFamilia').val(),
                idTipoProveedor: $('#tipoProveedor').val(),
                idFamiliaProveedor: $('#familiaProveedor').val(),
                idSubFamiliaProveedor: $('#subFamiliaProveedor').val()

            };

            Contacto.push(model2);

            for (var r = 0; r < y; r++) {


                if ($("#c" + r + "").prop('checked')) {
                    var model = {

                        idCampoPersonalizados: $("#idc" + r + "").val(),
                        valor: $("#c" + r + "").val()
                    };
                } else {
                    var model = {

                        idCampoPersonalizados: $("#idc" + r + "").val(),
                        Valor: ""
                    };
                }


                camposPersonalizados.push(model);

            }
            for (var i = 0; i < j; i++) {

                var model = {

                    IdCampoPersonalizados: $("#id" + i + "").val(),
                    valor: $("#" + i + "").val()
                };
                camposPersonalizados.push(model);
            }
            $('#btnEditar').attr('disabled',true);
            $.ajax({
                headers: {
                    "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                },
                type: "POST",


                url: '@Url.Action("Editar", "Contacto")',

                data: { model1: camposPersonalizados, model2: model2 },
                success: function (data) {
                    if (data.correo != "correo") {

                        if (data.cedula != "cedula") {
                            if (data.cedula != "cedula") {
                                if ($("#cliente").prop('checked')) {
                                    if ($('#IdConCliente').val() == "") {
                                        AgregarCondicionCliente(@Model.Id);
                                    } else {
                                        EditarCondicionCliente(@Model.Id);
                                    }
                                }
                                if ($("#proveedor").prop('checked')) {
                                    if ($('#IdConProveedor').val() == "") {
                                        AgregarCondicionProveedor(@Model.Id);
                                    } else {
                                        EditarCondicionProveedor(@Model.Id);
                                    }
                                }
                                if (imagen != "") {

                                    $.ajax({
                                        headers: {
                                            "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                                        },
                                        type: "POST",


                                        url: '@Url.Action("Editar", "Contacto")',

                                        data: { model1: camposPersonalizados, model2: model2 },
                                        success: function (data) {

                                            formData.append('id', data.id);
                                            $.ajax({
                                                headers: {
                                                    "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                                                },
                                                type: "POST",
                                                cache: false,
                                                contentType: false,
                                                processData: false,

                                                url: '@Url.Action("editFoto", "Contacto")',

                                                data: formData,

                                                success: function (data) {
                                                    if (nombreComercial != "") {

                                                        var urls = '@Url.Action("Index", "Contacto", new { palabra = "__id__"})';
                                                        window.location.href = urls.replace('__id__', nombreComercial);
                                                    } else if (nombreContacto != "") {
                                                        var urls = '@Url.Action("Index", "Contacto", new { palabra = "__id__"})';
                                                        window.location.href = urls.replace('__id__', nombreContacto);
                                                    }
                                                },

                                                error: function (err, scnd) {
                                                    console.log(err.statusText);
                                                }

                                            });

                                        }
                                    });
                                } else {
                                    if (nombreComercial != "") {

                                        var urls = '@Url.Action("Index", "Contacto", new { palabra = "__id__"})';
                                        window.location.href = urls.replace('__id__', nombreComercial);
                                    } else if (nombreContacto != "") {
                                        var urls = '@Url.Action("Index", "Contacto", new { palabra = "__id__"})';
                                        window.location.href = urls.replace('__id__', nombreContacto);
                                    }

                                }
                            }
                            else {
                                $("#nombreAlert5").empty();
                                $("#nombreAlert6").empty();
                                $("#nombreAlert7").empty();
                                $("#nombreAlert8").empty();
                                $("#nombreAlert5").append('     <span class="text-danger data-translate="CedulaExiste" >Esta cédula ya existe. </span>');
                                $("#nombreAlert6").append('    <span class="text-danger " data-translate="CedulaExiste" >Esta cédula ya existe. </span>');
                                $("#nombreAlert7").append('     <span class="text-danger " data-translate="CedulaExiste"  >Esta cédula ya existe.</span>');
                                $("#nombreAlert8").append('     <span class="text-danger " data-translate="CedulaExiste"  >Esta cédula ya existe.</span>');
                                $('#btnEditar').attr('disabled', false);
                            }
                        } else {
                            $("#nombreAlert10").empty();
                            $("#nombreAlert10").append('     <span class="text-danger " >Ya existe un contacto con este correo. </span>');
                            $('#btnEditar').attr('disabled', false);
                        }

                    }
                }
            });
        }
    }







</script>



